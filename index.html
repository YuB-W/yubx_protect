<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YuB-X Cyber Command Center</title>
</head>
<body>
    <h1>YuB-X Cyber Command Center</h1>

    <h2>Available Devices</h2>
    <button onclick="discoverDevices()">Discover Devices</button>
    <select id="deviceSelect">
        {% for device in devices %}
            <option value="{{ device }}">{{ device }}</option>
        {% endfor %}
    </select>

    <h2>Cast Text</h2>
    <input type="text" id="textMessage" placeholder="Text message">
    <button onclick="castText()">Cast Text</button>

    <h2>Cast Media</h2>
    <input type="text" id="mediaUrl" placeholder="Enter Media URL">
    <input type="text" id="mediaType" placeholder="Enter Media Type">
    <input type="number" id="mediaDuration" placeholder="Enter Duration (seconds)">
    <button onclick="castMedia()">Cast Media</button>

    <h2>Device Control</h2>
    <button onclick="controlDevice('shutdown')">Shutdown Device</button>
    <button onclick="controlDevice('turn_on')">Turn On Device</button>
    <button onclick="controlDevice('mute')">Mute</button>
    <button onclick="controlDevice('unmute')">Unmute</button>
    <input type="number" id="volume" placeholder="Set Volume">
    <button onclick="controlDevice('set_volume')">Set Volume</button>

    <script>
        function getSelectedDevice() {
            const deviceSelect = document.getElementById('deviceSelect');
            return deviceSelect.options[deviceSelect.selectedIndex].value;
        }

        function discoverDevices() {
            fetch('/discover_devices')
                .then(response => response.json())
                .then(data => {
                    const deviceSelect = document.getElementById('deviceSelect');
                    deviceSelect.innerHTML = '';
                    for (const device in data) {
                        let option = document.createElement('option');
                        option.value = device;
                        option.text = device;
                        deviceSelect.appendChild(option);
                    }
                    alert("Devices discovered successfully!");
                })
                .catch(error => {
                    alert('Failed to discover devices: ' + error);
                    console.error('Error:', error);
                });
        }

        function castText() {
            const textMessage = document.getElementById('textMessage').value;
            const device_name = getSelectedDevice();
            fetch('/cast_text', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ device_name, text: textMessage })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert("Error casting text: " + data.error);
                } else {
                    alert("Text casted successfully!");
                }
            })
            .catch(error => {
                alert('Failed to cast text: ' + error);
                console.error('Error:', error);
            });
        }

        function castMedia() {
            const mediaUrl = document.getElementById('mediaUrl').value;
            const mediaType = document.getElementById('mediaType').value;
            const mediaDuration = document.getElementById('mediaDuration').value;
            const device_name = getSelectedDevice();
            fetch('/cast_media', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ device_name, media_url: mediaUrl, media_type: mediaType, duration: mediaDuration })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert("Error casting media: " + data.error);
                } else {
                    alert("Media casted successfully!");
                }
            })
            .catch(error => {
                alert('Failed to cast media: ' + error);
                console.error('Error:', error);
            });
        }

        function controlDevice(action) {
            const device_name = getSelectedDevice();
            let payload = { device_name, action };

            if (action === 'set_volume') {
                payload.volume = document.getElementById('volume').value;
            }

            fetch('/control_device', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert("Error controlling device: " + data.error);
                } else {
                    alert(action.charAt(0).toUpperCase() + action.slice(1) + " performed successfully!");
                }
            })
            .catch(error => {
                alert('Failed to control device: ' + error);
                console.error('Error:', error);
            });
        }
    </script>
</body>
</html>
